function [Y,Xf,Af] = NARXfuntion2(X,Xi,~)
%NARXFUNTION2 neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-Feb-2018 16:11:19.
% 
% [Y,Xf,Af] = NARXfuntion2(X,Xi,~) takes these arguments:
% 
%   X = 2xTS cell, 2 inputs over TS timesteps
%   Each X{1,ts} = 2xQ matrix, input #1 at timestep ts.
%   Each X{2,ts} = 62xQ matrix, input #2 at timestep ts.
% 
%   Xi = 2x4 cell 2, initial 4 input delay states.
%   Each Xi{1,ts} = 2xQ matrix, initial states for input #1.
%   Each Xi{2,ts} = 62xQ matrix, initial states for input #2.
% 
%   Ai = 2x0 cell 2, initial 4 layer delay states.
%   Each Ai{1,ts} = 4xQ matrix, initial states for layer #1.
%   Each Ai{2,ts} = 61xQ matrix, initial states for layer #2.
% 
% and returns:
%   Y = 1xTS cell of 2 outputs over TS timesteps.
%   Each Y{1,ts} = 62xQ matrix, output #1 at timestep ts.
% 
%   Xf = 2x4 cell 2, final 4 input delay states.
%   Each Xf{1,ts} = 2xQ matrix, final states for input #1.
%   Each Xf{2,ts} = 62xQ matrix, final states for input #2.
% 
%   Af = 2x0 cell 2, final 0 layer delay states.
%   Each Af{1ts} = 4xQ matrix, final states for layer #1.
%   Each Af{2ts} = 61xQ matrix, final states for layer #2.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0;19.0430041];
x1_step1.gain = [0.004;3.47391213572993];
x1_step1.ymin = -1;

% Input 2
x2_step1.keep = [1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 57 58 59 60 61 62];
x2_step2.xoffset = [19.2379991;19.2508934;19.3319803;19.3253324;19.2263786;19.2315507;19.3075481;19.0596643;19.2903945;19.289798;19.2136344;19.2034775;19.2200445;19.2779086;19.2485843;19.3093057;19.3162792;19.3485985;19.018831;19.3562899;19.3020636;19.5188678;19.5442632;19.381342;19.3917523;19.9293989;19.8670507;19.6762796;19.6118629;19.4146059;19.3496876;19.2744025;19.1741645;19.2836001;19.2039698;19.2170388;19.2016748;19.2216557;19.2369995;-0.0129752;-0.0055178;-0.0151607;-0.0040153;19.3769689;19.3585567;19.2830716;19.3667064;19.2997004;19.0854427;19.8912697;19.3651094;19.4355323;19.3133798;19.3365488;0;-0.0001923;2.67e-05;-0.0002163;0.00017;331.7538614;0];
x2_step2.gain = [7.16897782563464;8.26193301968282;8.49584468236588;8.4366506665587;6.02462807711646;7.38770139797475;7.16006943835348;5.20077189856521;7.09747638580895;7.02558260521957;6.26553460987333;7.11659690029507;6.60113717790162;7.54158334788232;5.902724284339;8.370782119842;8.61971622170255;7.69862352460694;3.73960599885155;8.40732833181377;5.78114882989547;8.61047214232417;13.7332643007914;9.05680609921556;10.3557135837448;12.6312226139303;12.6379671071631;15.6045434188618;12.31104091082;9.57133805391741;7.37843475360822;8.25291214321121;5.90334976727518;8.83759157954284;6.75474174427018;7.88718486259939;8.05541156507379;7.09530592298402;7.22302758979851;2044.36266993765;1318.47847583888;632.071297642374;202020.202020198;7.55781920638364;8.39296535216049;9.53779374616395;11.1135252157554;5.71563950432827;2.71524272097732;2.68574296177556;11.7705496140437;12.442902630554;13.7261953457218;15.4729779912358;0.004;32.7089200495867;42.1893754495805;10.1133760016667;6491.39889646219;0.00525900604785696;0.00369685767097967];
x2_step2.ymin = -1;

% Layer 1
b1 = [-0.80505217183429900185;0.20063241661346067901;5.7439372530050007981;4.4900701707234649263];
IW1_1 = [-0.35833104895465711648 0.0013581688491186949368 -0.21472429099915496531 -0.005483729550698436192 0.051856303059663148847 -0.0065876484013550262384 0.59365759884669677682 -0.008062689131190788755;0.27799499498915641871 0.37314605571877546009 -0.039852481866455194415 0.089940698854247699834 0.1750119130222503594 0.65528444060267210247 0.14198442011701795096 0.61203542524388543367;-0.024998180005134901238 0.012386266522869062226 -1.7484185674855672321 -0.0049911852531206004138 -2.3829727838779573013 -0.016570944461664214448 4.1444232908739158106 -0.00076602195681498041254;-0.0014367172533363298942 -0.00056928941959275317867 0.024110470777386566743 0.00015069495292935921856 -0.011802733234326501927 0.00097737512812561184485 -0.014313037942253158119 0.00072243918064045047327];
IW1_2 = [-0.0026732868228410279314 0.0014301404872724629309 0.0013888049812293815945 0.00069938210134300475476 0.0018382624272542981425 -0.0052654217195607366797 -0.00049850894113988666358 0.00034855839278806927421 0.001186672283168726692 0.00064459346807674874728 0.0085213132715823737551 -0.0084454629645710592445 -0.0050702746889056994617 0.0018161631645870993535 -0.0010236058987011691698 0.00081688147988697010129 -0.0044278194255061254989 -0.011439067926409324932 0.005142319565667552092 0.003154866009900110773 -0.0043050640108046695984 -0.0074449370073623698241 0.00020990139509236008177 0.0003613108886641016107 0.003064096927485778811 -0.0073230233130221200621 -0.00011281162350445269986 -0.0030383456803919606758 0.00035727646908906285361 6.8682454905475190908e-05 0.02077030121017964942 0.0048656367666155397184 0.0018140783735664856892 -0.0027743013207922480844 0.003668339141371699131 -0.00170874547258297667 0.0058605687941754632669 0.0013680637105522703255 0.0020190146352736400813 -0.31532221343424382543 -0.89904722908357925792 0.14452236533032189469 -0.0088777755998125876952 0.0031591979830518138704 -0.0027526305560469587451 -0.0023596793665647086517 -0.0044199779269911212976 0.00061199779315057373143 0.0069479316786851732374 -0.0071277392048244292422 -0.00065698550528107383002 0.0063946280048877077173 -0.0025218325462759939512 0.0012026324344122391735 0.11746342422290136087 -0.063281415484983838393 0.81998649602871176434 -0.069808070251674653184 -0.0089325205370019266499 0.036730858767699645084 -0.79419949470543271808 -0.00075431348785596585675 -0.00049607894684830945026 2.8781160454874811126e-05 0.00082103794888436045559 -0.00082572496580843920272 -0.00097347940114355063605 0.0015132621901469674262 -0.00012745392818508784541 -0.001349200405649567374 0.00027295972243861731099 0.0052837901497846404344 -0.0032823880587856406506 -0.0010670778773892994947 -0.00016181425500833999855 0.0010500339828464452015 -0.00067316033146227007879 -0.0043105147141627138743 -0.0093007086259348451668 0.0047623618603750278444 0.0015832977627394471259 0.00078882708623964192113 -0.0053533993132165386478 0.000537306696390305971 -1.5043734962453267703e-05 -0.0012809959028930197316 -0.0022823794900019398098 -0.002903266987857664426 -0.0034219765772507113911 0.0011041436958849379195 -0.00061052517694414607571 0.018553200195440912312 0.0033766426465926605016 0.0008586985258671076416 -0.0019129141238316185042 -0.00044030649934176114548 0.00033194740659930215866 0.0055730899182092289573 0.0012402051881953996687 -8.7570670048318130074e-05 -0.25879760750354097176 -1.208429250031747948 0.10672165748655149109 0.06368002865630137399 -0.00018022002740100532582 -0.0039528486902307207948 -0.0017355200426640467193 -0.001220194226153663037 0.0002216988627412805606 -0.0044761302820609614322 0.0029660528397526956038 0.0036115657606000648762 -0.0013217262600432881821 1.3806866958802351637e-05 0.0012874202578142283568 -0.57225563946850011021 -0.36812371313209329982 0.48125729900606789569 0.019253274224186090607 0.063913399587731692386 -0.01732806777728986003 0.3186868443715822341 -0.0031669829648769431442 0.00091989932895306808242 0.00014270192571693194423 -0.00061836802650523919195 0.0053015080103218439889 -0.0057036455888033969069 -0.00067585464734527833132 1.4137703616129299326e-05 2.1864084064976191304e-05 0.0010029946715294185515 0.0067932489346666487598 -0.0051053245528022905483 0.00029483606305318618788 0.00098420120160504611165 -7.6903221049937921759e-05 0.00023096323921000506637 -0.0043376006750090760275 -0.0090998845257480032167 0.0012127636513532189227 0.0011619243482525597622 -0.00059487626531457287078 -0.0019410380849522903927 0.0023254588145502296491 0.0019787044455100285742 -0.0031020990761438434896 -0.0026144812809135910964 -0.0050226346689183501773 -0.001066244589774492527 -0.0010822647701027492476 -0.0032630462671031108118 0.02050795659834765694 0.0029244338177004812647 0.0030749282878148871505 0.0016191248908436633742 0.0036167755714013958418 -0.00018728258314356478146 0.0059667135670552103044 -0.0013108473366552104034 -0.0013718250392330214732 -0.23927448617832267064 -0.68517940848460279213 0.14557811575240786617 0.0057894592094778971059 -0.0013125414589707251091 -0.0013423613597279399588 -0.0068981017473400095541 0.0034578702334881129994 -4.9484935863001707282e-05 -0.0033963130280354933942 -0.00055063400863204076119 0.00077922181777447289356 -0.00074771977599204578202 0.0021537894127157896328 -0.00033086210456838592358 0.15659142800926018069 -0.07290527789465957309 1.005939299917037788 -0.060526856372860794731 0.0058687950442707914611 0.066387045563830002215 -0.25027569337736377264 -0.0018797566862390065971 0.0013040820531511178662 0.0011548324396960245493 0.00029859040614753568684 0.0044521605062008097128 -0.0060977353937358763289 4.6093807713127122932e-05 0.00032690917926041896486 0.00095756752876515111896 -0.00032351086724211584617 0.010777550885089116905 -0.0044579137005665188387 0.00040469400333790865598 0.0012051819376994634802 -0.00021139678789798218867 -0.00031030026475381555784 -0.006521267525794237005 -0.010186647208260186936 -0.0043681827753552469884 0.002788544794982031165 -0.0037441546614264869033 -0.006937452913913071291 0.0022452275137171025243 -0.0043750500493386947076 0.00058371654652051229665 -0.0046029864782650567814 -0.0025376252338133579479 -0.0019305766503798827988 -0.0022731245160510652262 -0.0026654302651611403233 0.024731319659144403861 0.0020649354110021419899 0.0021494593195660995424 -0.0024836414554552559489 0.0027401727900290932805 3.3185842035124814633e-08 0.0060634700975374655751 -0.0010428708276430768975 0.0004856243294351819716 -0.035445530505252405284 -1.0715419043713019231 -0.25859498325637059191 0.0047894563003718446798 -0.00056907930193630007661 -0.0051381130991634670763 0.00021001742180603937514 0.0026893198276235989047 0.00074716394500243168281 0.0020945386493372956938 -0.003381346567233271122 0.00063787207330733811279 0.0015222068462929282204 -0.0008537357431125485981 0.0033507907469452558394 0.31359910958621917132 0.067023333136255275333 0.67040451993447414125 -0.21728468386549792957 0.0038703017106008459972 0.17217395344577859917 0.18824510580476083721;-0.29474242188335464387 -0.053531268654064469159 0.2094673512754777478 0.13256441111553296519 -0.62840461598280228372 -0.40487647348746980125 -0.25641844283425335727 -0.3983788908882778812 0.21652454585539246401 0.47505350981473509764 -0.13373413604012474032 -0.024241754477268593476 -0.4123653137607199981 -0.3428448912803572779 -0.23492708019033073374 0.41929922412337000681 -0.18276452360087239168 -0.023910329635650717089 0.24863986222147449467 0.7040433834605951402 0.00090405888510246106005 0.048884940840025002673 0.020722313653170763154 0.34466562938803951832 0.098220807196838746944 -0.3560208939847888665 -0.41165359474843632448 0.52881086298250823408 0.27585781590100383331 0.66037654836198567132 0.018431019236625375418 -0.26078494685271580433 0.083033494769214330478 -0.065334866522916076881 0.29871324392971837502 0.22671898565364967393 0.025276797933201793772 0.30724436529264048668 0.041567891361708519948 -0.30449922089422060134 -0.003310570975542446396 0.37694272317085875112 0.47162586314146665023 0.037071881623928028271 -0.17652196682342841116 0.089997969602376701181 0.4745530995924683304 -0.56168486404436490655 0.46055339897929259418 -0.4470404261437119775 -0.19075591296373600736 -0.87502708118936556314 -0.23909785042560116608 0.38926062669676658734 -0.20808698458575938806 0.35836649002208376125 -0.0084725193315178994741 -0.24211066035642681005 0.3005724135001801578 -0.095740152363167865812 0.71254382761907830712 -0.16312022826210081927 0.49110574281888236259 0.20602170432605432238 0.55605798581089549426 -0.23260358002776754249 0.10406739356631640459 -0.31059012615114628408 -0.084779378682889525165 0.06333885672314699955 -0.18504681896270214203 -0.17488622212948751189 0.1157247237312778454 0.39660847309932323324 -0.070426456587461286341 0.33557138655509066716 -0.066028607399604449801 -0.45769072292437978922 0.022518919881347135986 0.48163352450968194285 -0.28392163179485835345 0.048776966006877732485 0.13208322199488695126 0.39402022285742616114 0.078059091456987125812 0.10091968852637635268 0.092329267888505511808 0.2394827021039407644 0.24435050989738318905 0.19683484590382666068 -0.090455229865117781074 -0.1674626181265209679 -0.094682188892418472914 -0.46400462735290193272 -0.23835090477259046615 -0.072019917863263518965 0.16298422592536099263 0.074733459169703503333 0.45787439425008163996 0.75420819127590510433 0.095113734251135562126 -0.067536521680842578896 0.31752767537868836767 -0.33162633722014778215 -0.34104127263832739736 -0.27514348866048565778 -0.029544929831234016671 0.36750008028091207812 0.013950767275665782938 0.22878425719177858388 -0.18817067899726094837 0.71024685652901264898 -0.64480658832830994864 -0.061840810885425714916 0.56474071433434025469 -0.013674389036354451035 0.14724279467189668735 0.14235777791091830391 -0.18512074588497912098 -0.30524440461693808091 -0.16742583793626678035 -0.78374310135056435289 -0.42972649540708030003 -0.10635119261226877452 0.1941797885291128567 0.39604815163518103383 0.36602756725350871214 -0.31528364744104070416 -0.046670867528983667194 0.026572235582538884791 0.087688927460386575929 -0.11452284521875862044 -0.076905504930228463234 0.010836427941011864823 -0.024640795942124048973 0.28263732409335456941 -0.10167546526803206142 0.40323563709052051562 -0.041838770501995116435 0.23099361779303098641 0.52293186332137142625 0.5089887373719886865 -0.00031623808211680753868 -0.10484325131854282942 0.23840580064032407259 0.18907660561721528758 0.1077848421083866387 -0.077991149548642391132 -0.068274066009073014483 0.20993413198677762788 0.53534422173500217923 0.011748119317484106289 0.040595163307352716275 0.29331188315706108183 -0.13610554293706567108 -0.19611538432245467778 0.076118286589425557254 0.078297153307719080662 0.053976900485610053437 -0.15515068313704025171 0.23900112233476122903 0.14281691454030498445 0.2371571322849069241 -0.1592145800822656887 0.12219964971710642332 -0.10559413409224570335 -0.40244270902475121066 0.34610101137095056201 0.63806132177159513574 -0.67510422728446350948 0.0049173166010175947682 0.26182038890816683452 0.36408830744116615907 -0.031101387834730723214 -0.074111346785928899905 -0.49064438419371142475 -0.3636270023421590003 -0.27230237811340285425 -0.38855909028005813921 0.03043114919557867587 -0.048378166919960441383 -0.066359474302130225243 -0.85417512453295618702 -0.30313370772487535643 -0.15636571712867106121 -0.0098559795685210019323 -0.269687466134260867 0.14696678624102602062 0.39329968687328831223 0.1550422527831411823 -0.060886084646307125912 0.10223808189345436059 0.18066375847681415134 -0.37243241446616875967 0.12405088206473301182 -0.057443097383927603505 0.093133268497937557462 0.046784362369780577162 0.030590608468601097197 0.086741028702408393136 0.11631734982246533239 0.78811741858477801781 0.38501787237308021661 0.18081471422072534216 0.33692919334810594867 -0.11254939262907250053 0.040363508040827035528 0.15634189820268959425 -0.33927445283379781271 0.05425473557820160303 0.15523541280319128055 0.68665179604612980313 0.24926501381369425836 0.48520653548426773138 -0.30471140814814501319 -0.74973114529291651209 0.34314566873016061344 -0.058458021467895950052 -0.07973888961484046356 -0.028372726825473010281 0.468252553884118905 0.18944438443395747451 -0.29132503043246221752 0.61362819070853524828 0.12909380918344140476 -0.13109185023149530491 0.31778402707571645758 -0.61996904023830678998 0.36375388455774954055 0.44472663557716185512 -0.24904413702250677298 -0.015339210316552817637 -0.39167438571612767095 0.33732934587951024508 -0.24175688190948527168 0.096121360893834023598 0.05342425726409601866 -0.20238115546328525052 0.11111004427018118801 -0.79874177402665669234 -0.21089177717023530056 -0.29067179022101308217 -0.19192490704238421295 -0.94554961575040841204;-0.0038987822420348352583 0.0033234620055830176727 0.0035765511983060585023 0.0066523784104379852719 0.0087744010430253760457 -0.0098337425311344137113 -0.0045270929031236062032 0.0015761801496184304344 0.0048367680072740285718 0.0081593748660288116514 0.0052125226214917441681 -0.0098161722019212485635 -0.0045580250642176193404 -0.013879540122781671221 -0.0022265726263462951549 0.00064696046086135518098 0.0086033134164661077131 -0.0011469372733294933703 -0.0037768904691976475096 0.009849713271393339617 -0.031145495615675911766 -0.0010040873341567305762 -0.0082609956336925794568 -0.0027857592724248613804 -0.00055205399348124913929 -0.011946422982790333434 0.0129650268421906429 -6.1887334065600417359e-05 0.0001005202368523961824 0.0198747168005735525 0.016599980591270647318 -0.0060206639990683531033 -0.0025113142438383754401 -0.011346753545176654909 0.0026670248347713137495 -0.016720212225950669555 0.0079121811035874137219 -0.014313373379956853201 0.0012718011526758627588 -0.10423249244687245174 1.4235334695543160333 0.10267639946079479274 -0.10190870869664715725 0.0027434543458132241815 0.01960128736979691727 -0.0080073358267245178105 0.0037493634369458214532 0.0016635266919787718327 0.0013102659297945253546 -0.0021758491038417889993 -0.0014554573103883836765 0.0095590012569159235611 -0.001840710551481065417 0.0053589499301157925495 -0.12982669602706156664 0.21854121587859173803 -1.3106343240513509407 -0.2085606580278362987 -0.10396293090943597992 0.086567116753392972517 -0.46282857808691263424 0.0003011478971866911325 0.0016199314651439409608 0.00090789525407711972951 -0.0071204589262229252625 -0.015915985136128314031 0.0066287133028561174078 -0.0020027252473997420902 0.0023014231949720432083 0.004316556806416307901 0.0053457254026018797416 -0.001805603442967874863 0.0023480473611295817754 -0.0066050511274725427421 -0.0028433751016191414693 0.001849834588749098372 0.00037760564401306031526 0.0047783968044795739616 -0.0064772402542883095872 -0.0050043452430861695701 0.01747472478699716239 -0.011467778495343585246 -0.0079067333841406906014 0.00079890626124687043417 0.0027134555576482114955 0.0010846302768853849016 0.00048977391469010196894 0.0014239364563927241723 0.001500341789434661826 -0.0029849853131523854284 0.0059757032274081406734 0.021019607533645793401 -0.0017174491746291405906 -0.0037901758014081661854 -0.012335973892223081952 -0.016392033965180231175 0.00055069944809510874145 0.0053407884418150020772 -0.015797920894123223395 -0.013240465277175053616 0.024304377035267263341 1.0827867215838224979 0.44315655268310139014 0.15499429136888373537 0.0018194500323948134112 -0.014685046142335055411 0.02365145828104108644 -0.0073570818618399523928 0.014813603672025986782 -0.0028224730639375824812 0.0043916095296827658417 0.0076448509041900768873 -0.013431978988410720258 -0.0011921812019357414057 -0.0042971196647432962842 0.081884361552614373658 0.033793116930113942242 -1.1528944058980989951 -0.36452951248675852236 0.15524816036008054487 -0.15903974693450981248 -0.060155953590335736747 -0.0077924480954803974561 0.00301444010501483858 0.0012614094558449529416 0.0031236417808120590239 0.0057565667217035782627 -0.0082426986475596028536 0.011449540584680827429 -0.0056466229136509279302 -0.0019349817561917885544 0.0039301794826671274108 0.0009341832634432443213 -0.0096598885025304843943 0.0068875341781304026331 0.0048543840479892868059 -0.0011123079306197400026 -0.0004947219950210680851 0.0045292540221601182773 -0.0060673778916004771425 0.011662902123007762994 0.01269571260729141296 -0.010546589622965521493 -0.0043129054834314456066 0.01191445299292476917 0.014915753292855172749 -0.013674791530533306899 -9.8178653475268127214e-05 0.0019995380265356611782 0.0074939933498863508035 -0.0070007505350770573432 -0.004816629108384379819 0.024596566838537448074 -0.0062782596793471570976 -0.0042551176984525302879 0.0013509836998307201122 7.5118010541104117059e-05 -0.013037429579610631744 0.0004812706514330416835 -0.036143014705545366272 0.0019861915470702862056 0.27567934486782907921 1.3015708068059590463 -0.43474746349290227521 -0.138913315896708911 -0.0040863537513539391691 -0.0026529604225311934074 -0.024028877195620489127 0.0070000772466053892695 0.0022326466663619556549 0.00070039291511576646111 0.0054844304118471208509 -0.0069227632156215954118 0.00066446981337349182023 0.012784559419447011006 -0.0086589567461493772982 -0.085941834211236745045 -0.14714713811535790056 -1.255083144205344059 0.33774694718844211483 -0.14009238300222184859 0.0080457679691137377193 -0.06075761406589007263 0.00018715943011071901501 0.00059270748411687141678 0.0041255459223657319628 0.004508738945598157917 0.012359329729157734687 -0.016962956808389630797 -0.0020188469558986509543 0.0032245026228385495828 -0.0022175688622665273332 -0.0076690552297922331276 0.014268999451576789075 -0.011611209132339612299 0.006585298505620122006 -0.0056692163790797436493 0.00055082377091842011935 0.00021159236231237766668 -0.0039941255675026545238 -0.003577195919259836248 0.0013293944154037097127 0.016201489701070416471 -0.019259861126293496142 -0.0092212835683273455117 0.0010222870026560275034 -0.01969053282138321509 0.012837220746177633451 -0.0025420098716715930007 0.010464270593021459538 0.00028678900524661322426 -0.011277427727582495579 0.0042486252700038081714 0.031518415511798292261 -0.0087367393313843907249 -0.0074287481343669158063 -0.014666901705895631428 0.0022134162649149174279 -0.020950700600752505953 0.010630868170715941298 -0.018787309737953655081 0.0078415419743402704073 -0.011020424679937837822 1.4232260700875809523 0.22993443774108415778 -0.098877606190635014549 0.00038785689730514778155 -0.0028921576839286947287 0.0077388512277675137671 -0.00049240577100666672698 -0.019259054234984116644 0.0009122775761478546519 0.0054434595035550408654 0.0012012678043904108371 0.0026640986152165319588 -0.010405348857148385283 0.0072324202213864150976 0.07993273065154221646 0.19817591535327169772 -1.2332459845940137999 -0.063813913722746112844 -0.09896479917123746084 -0.0030143420234085963917 -0.20032235032247847073;0.00053474094148000324463 -0.00058902264995132531684 -0.00025725941468840364968 -0.00016984096220454413689 -0.00020739025910418312803 0.00083474041802149268575 2.3835278047114041101e-05 -0.00015265274314971133927 -0.00021792974134165541528 0.00018388519115611554598 -0.00082470886520516722799 0.00097554882933014938629 0.00014822211960650849951 4.5871884452579183634e-05 0.00023640826619439136254 -0.0001176750966451328153 0.00018298457871308282103 0.0018154224404293727892 -0.00076810311148289508749 -0.00069372869581126983107 0.00091608446693642220544 0.0008787195992546039747 -0.00015745651139985943567 -3.234638813438889184e-05 -0.00017357464128366231022 0.00037585696244337086407 -0.00033991477114453405063 0.00052474345072604756338 0.00047080851204835935707 -0.0010054472719215642833 -0.0046327724821832736227 -0.00070998024893435991711 -0.0011675568391555626781 0.00020502683175929213642 -0.00051931686991909674529 0.00081115730847252200727 -0.0008541772659509390235 -0.00043596708727361779823 -9.5697800514699005061e-05 -0.16142062916943775153 -0.32922252105534105526 0.11892045504167116088 -0.0024987869174193794164 -0.00060578969953124491097 0.00028408023075954160624 -1.8027164796666234346e-05 0.00048402571254782441592 -0.00012512965253672864532 -0.00047214524394866984498 0.0019144979953658984584 -0.00010085651542118306736 -9.4788451426352029767e-05 0.00017534034343558751643 -3.4834418918783911171e-05 -0.012478510357048864382 -0.16980937201498919054 -0.26453631607795435876 0.10742153496499164123 -0.0024009508135307885274 -0.0095963006680577674079 0.014482592025771809027 0.00024996604383989949605 -0.00023344349323870276433 -1.6759462980563006045e-05 -7.168924989747251788e-05 6.8959597035765635544e-05 0.00028467623834581696997 -0.00013700830284162440428 6.3234972757917427681e-05 4.0120694830693858412e-05 9.4408121019776185473e-05 -0.00063952424278344323621 0.00065567316967730319543 -7.1204172584420954756e-06 -3.9488691478354053009e-05 -0.00026081240415006196401 0.00010604536875017644948 0.00015632309056846956769 0.0014454018649830704338 -7.9896616926535866748e-05 -0.00048280967425639470005 0.00025945931141391117549 0.00048576277505243861243 -8.9880070347888037338e-05 0.0001983249274574815492 -3.17573899882300854e-05 1.2769867235715004399e-05 -1.1630111498423116497e-05 0.00035427041625970065323 0.0005845817743484617952 -0.00082184462408622254749 -0.0046779973225723851804 -0.00088958508583743950687 -0.0010112399235630831467 -0.00014069682172834259296 4.6174185728274159046e-05 0.00061252552277317061282 -0.00062826957801771733322 -0.00014069255097000761502 3.8450229418616366933e-05 -0.59402346263030736395 -0.25690125441181271837 0.0048337548683474789932 -0.0055782471942936694143 3.4871818890413971393e-06 -1.0711746305696894681e-05 -0.00019423865936055433479 0.00022443744427184359022 -0.00024088740381308403125 0.00041693160306086941326 -0.00075577393361806117274 -0.0002538621140698100109 0.00014355737664315388865 7.2548722846120359707e-05 4.9921453588702566695e-05 0.00026561450829251615846 -0.58961325016122789755 -0.2383163009351947359 0.028837557682961634936 -0.005600249493502879039 0.035519640132481079819 0.00074267570587970900033 0.00038714328194235141318 -0.00035268445912458511139 -5.9553647807274694956e-06 0.00011626383859936722913 -0.00065620500993609923515 0.00081791235484368987087 -0.0001314331390575439087 7.7760208635123203203e-05 -7.1830315554853848355e-05 7.5775631968603003553e-05 -0.00083699940255456905212 0.00084860618836830859456 -1.5588617301978929634e-05 -0.00017601172452165155576 -8.3941622260958175666e-05 3.9259442286391773929e-05 0.00012631328504222451921 0.0012236284934434393627 -0.00028127507761429952887 -0.00040127961474151484537 0.00035589313809929862785 0.00022342141883967451903 -0.00027495093066036966657 -0.00010573797409089805176 0.0003891752324943895309 -0.00010315568408849641862 8.1908272792605306867e-05 1.1504881590710792867e-05 0.00090171699606808846782 -0.000420728993150156611 -0.0049955063397683803494 -0.00061668761472135897976 -0.0011875348145718089485 -0.00044208403585813349718 -0.00061065305442217180255 0.00071448130262730959704 -0.0004969152991122984149 0.00014388692814402173322 -0.00015725132806211655117 -0.22899217395916610096 0.15053249666611298596 0.037495508699407292807 -0.0012351516289818174552 0.00036495061040620085284 -0.00027530457105529000184 0.00051092793485250096244 -0.00042280617335506052133 0.00029253601546888824761 0.00058253798857120964345 -0.00029892431094435115884 0.00038028256495987409211 2.40525783531959446e-05 -0.00047091637092598197549 0.00015671749953976421956 0.0018176326428133075894 -0.22464319181623609856 0.14608314433191676995 0.042082894106791120248 -0.0012114766239450568217 -0.067325537787638806142 0.0025856945818075135514 0.00027501734707605757745 -0.00047450162758015033927 -0.00030743504599121479698 -0.00014800011653637624456 -0.00071864778737499169625 0.00096365984025572324657 -2.0479501040415803108e-05 -7.5649179351065337596e-05 2.7044765778664869171e-06 0.00030223570690556179246 -0.0013777916692518912736 0.00091962091236506534123 -0.00014577729830572458782 0.00010642761475378328213 0.00011109224816825445995 -7.710496968244427078e-05 0.00045236373009038637321 0.0012196017936281138092 4.2041186630770170554e-05 -0.00063928039612173945955 0.0011584020832546518699 0.0013141763576334168206 -0.00040630885171632265956 0.00028796553168790241673 -6.1068790175390280715e-05 0.00025046440625698827495 -0.00032978638057231459161 0.00010695016052956289316 0.00098080983863594608206 -0.00059520857817670601297 -0.0056408518468616187028 -0.00037439815119767960944 -0.0012265693418708040717 -0.00022081511915535031966 -0.00053181651051220787084 0.00078973176754800378414 -0.00060933263579931898173 0.00017629602527381555929 1.1419331127206653196e-05 -0.29742089687509254414 -0.27842426297386468903 -0.083946462582636757754 0.00065441687847799553772 0.0001214898908030029377 7.7083880022863968118e-05 -0.00027711831532224647521 -0.00034140027783950504213 0.00014191052257227009881 -0.00056009797702133900989 0.00040991000551708742152 -0.00012436252022188966772 -2.4562471641790583948e-05 0.00030911629714698254283 -0.00020949463576964166855 -0.0021749152387206629501 -0.29875211732865480929 -0.22958894227515688757 -0.10814121767786299966 0.00069466387441180835454 -0.037979365591590846796 -0.0041322446123897320011];

% Layer 2
b2 = [87.092754680058831696;82.231940286162014786;80.64237895973759862;80.298824980646813287;90.209500858958250546;85.854704230679388388;86.560659549197765728;90.246984339487212878;61.046252489542389696;61.312518401767491127;89.710379293126820244;86.9673943363565769;62.763546615956144592;59.718116128662721565;45.593474833421815617;39.427749704528473274;36.534445661156304652;37.07735342257686284;60.724413775920922376;74.8905370987751553;85.034372529855858147;1.4693219133761954431;0.90001564666411326687;13.704080241709061028;13.015377631730943975;0.60883785572583026813;1.0140959581592710048;0.90014045903307782215;0.37017582583013414199;31.553519092897683862;37.820510057064900877;33.762773013015277002;37.763545574596747656;35.104512055583725783;38.423948955031335117;36.622641988504689436;36.963220271771817238;47.27214987865249185;51.633856236588890454;-0.048706810034285744071;0.57035519872098083827;-0.7383919017283266939;-0.89728852716548979096;120.74903949740529185;134.13532209376643323;146.7481350449414208;132.73374679167400814;185.73102176227277482;29.787832937932940069;1.0034386811506050829;119.8018360484025493;116.80064184860201237;111.40724040115240712;97.136978916074227186;-7.6280098606602404487;0.84333914287629896389;0.78225982008590044803;0.2584614011772620179;-0.81881808452772941731;-14.667621117448014445;5.5489117788068922366];
LW2_1 = [60.28396705824189894 87.069011631565473408 -43.198556459098625737 -56.26263042853780405;58.480280529581513349 82.080619340329590727 -41.404019658947447624 -54.961105208198624439;57.203105702628391782 80.608515185094631761 -40.687177167475248041 -54.625503617754510799;57.151656690031401808 80.276300916225650894 -40.513601183726265731 -53.615440053679904508;60.87920186277520429 90.077835764543081609 -42.322292072199850566 -58.086926768835610346;60.223816196912558496 85.712033100880816505 -42.489389195365951934 -56.465158063542432387;59.609646575972895732 86.941044446378981547 -42.663852141819575081 -56.493091827752756728;57.533221400090049258 90.310508429808564301 -40.064923035221902126 -56.725077794652506213;41.152009196404570446 61.264023582781128141 -27.242665670907424413 -43.189229232717615048;41.291235125564710984 61.784936222702455666 -27.183847230937466577 -42.49787129150305276;59.993318377611814185 89.912212246101859137 -42.730733936739952128 -58.380682163386943273;60.327724717552882794 86.532996873729558729 -43.210740140355540007 -56.957577690593737429;42.429022948765933165 62.211556059687012521 -27.465256137425591021 -43.774820754591495131;41.663694667388583071 59.728389707843156486 -26.681112142265785536 -42.525466829692419424;29.612605511415409865 45.821437493548067721 -16.757044828543804726 -30.050794801250585664;26.928675865072523976 39.802560814231185304 -16.500550312984238133 -27.080391926446509387;24.617251076516108554 36.154573079550338832 -15.492548831545830623 -25.796577895753241449;24.181115697547987509 37.391441250898708404 -14.299909367717809516 -26.508735477684162163;33.281922646355248219 61.008888119077759882 -19.509513376661541173 -36.518957592820463276;52.337987221473660782 75.01079304516628099 -36.689370918708185343 -52.090388933712503672;56.545606027886314848 84.494125058314338617 -37.970229538518431411 -57.186212459019266419;1.6608750403720067279 0.82743755270469154794 -0.8998987646955757258 -1.1873326152230636588;1.1558650791153850523 0.8339698964271938797 -0.10610209609470885872 -1.2643120571768804439;9.2616705810192403447 13.462332317843273444 -6.0405680163223198775 -10.833562933861696109;9.2742532747358374934 12.944858289409056695 -5.3528007496442020496 -11.531031812364131994;0.45271143049887357934 1.3940046373341137276 -0.047760780439286922017 -0.93633928109130448725;-0.037001959450814352059 1.6386982449990370458 0.19635574794815935373 -0.4650733632818063179;0.98135465126728027574 -0.3678515201447137839 -0.72723338942526249973 -0.079906875292287557477;0.51109510518574630122 0.66625975479888477349 -0.28498596843211748686 -0.46690758051999187161;21.427531391247182313 31.344437010320927328 -12.937464088907317361 -23.049773409757825959;25.058892709753465056 37.543874736018651106 -14.285033929587523716 -27.70825106471185606;22.186427423200200337 34.402203584218987942 -12.887533208562587106 -24.903761532508852383;22.724858404279927981 37.425175292141517502 -12.639591951148011262 -27.134272953530267358;23.460824121025034117 34.760534285016888134 -14.840146754923384975 -24.750785089115264981;23.998278405892126131 38.614835134839594843 -14.430438531973045713 -25.776539362546621703;23.313009262595393523 37.118863717726725326 -14.173533000167990892 -26.069885415511308224;24.426905931880085632 36.58988527127876722 -15.003756710437528454 -26.39848450684711878;30.012660740309197394 47.891337211466144197 -18.444855221576482052 -32.210836781314363009;34.178355538825229587 51.859700826325237699 -20.935802720964382218 -35.854947646702889585;-0.40764702245544520709 -0.68361146150031182334 0.8019184156303138522 -0.73589960706191515083;-0.074419509093040403513 -0.8757002507801364688 -0.57152268563196939599 0.39929581985897139029;0.85023506415059180163 0.40322082561860433936 0.094512892407230222891 -0.028090303320945149423;-0.56822171499212426049 -0.82703660127348599396 0.56941895938935527255 -0.63456749858674810216;83.828212662750033246 119.05221453462149839 -65.317152168947913538 -76.555600832910144504;96.026579086722804846 132.17833822292752188 -75.968977212262700505 -82.754359046551655865;106.88728870385573089 145.04444255315519285 -84.713455958269648249 -91.714436295140586708;97.067148886843128253 131.31473028694372829 -77.310895286948678518 -83.629521903252651782;124.69148619550693979 183.02693495525645062 -103.75626687298985473 -102.32365442436662306;11.958722499353863 29.882398455615241772 -5.9818714029053792203 -26.146589526143340976;0.84256555893188467277 0.86391303522153606309 -0.14878514463236028331 -0.90851815381977851782;87.602378986079017409 118.92462308026931339 -70.22752531000099907 -74.645508782084320387;86.278223089312831462 114.67851287525229509 -70.045073107481158559 -71.888043886145553074;82.443442977154390405 110.26835585788870731 -67.468164148007886638 -69.225215651521054383;71.903231379545758273 96.02496046126167073 -57.72793526880958126 -61.97125759091790087;-10.463020946672923372 -18.199745175585281487 -14.03342896896977976 -72.798174733321218355;0.054575160444599153664 -0.71880956455779898562 -0.97744747107250429252 -0.23245731003059411091;-0.45857115738276038597 -0.13888954351377114094 0.61971131035644033691 0.46826534203740594053;-0.53129191061701430687 0.27683828233531915242 -0.0072028584839171289414 -0.76005784186957214832;0.68345871672776992156 -0.30772059417185571029 -0.35166792257788020981 -0.88375165307193515041;-7.0329050016706435855 -16.901414782008309601 10.725488322981275857 -73.494451829651453068;-15.088925894895201196 6.548911778823302221 -0.36049385023823737884 -3.4033430593900177996];

% Output 1
y1_step2.ymin = -1;
y1_step2.gain = [7.16897782563464;8.26193301968282;8.49584468236588;8.4366506665587;6.02462807711646;7.38770139797475;7.16006943835348;5.20077189856521;7.09747638580895;7.02558260521957;6.26553460987333;7.11659690029507;6.60113717790162;7.54158334788232;5.902724284339;8.370782119842;8.61971622170255;7.69862352460694;3.73960599885155;8.40732833181377;5.78114882989547;8.61047214232417;13.7332643007914;9.05680609921556;10.3557135837448;12.6312226139303;12.6379671071631;15.6045434188618;12.31104091082;9.57133805391741;7.37843475360822;8.25291214321121;5.90334976727518;8.83759157954284;6.75474174427018;7.88718486259939;8.05541156507379;7.09530592298402;7.22302758979851;2044.36266993765;1318.47847583888;632.071297642374;202020.202020198;7.55781920638364;8.39296535216049;9.53779374616395;11.1135252157554;5.71563950432827;2.71524272097732;2.68574296177556;11.7705496140437;12.442902630554;13.7261953457218;15.4729779912358;0.004;32.7089200495867;42.1893754495805;10.1133760016667;6491.39889646219;0.00525900604785696;0.00369685767097967];
y1_step2.xoffset = [19.2379991;19.2508934;19.3319803;19.3253324;19.2263786;19.2315507;19.3075481;19.0596643;19.2903945;19.289798;19.2136344;19.2034775;19.2200445;19.2779086;19.2485843;19.3093057;19.3162792;19.3485985;19.018831;19.3562899;19.3020636;19.5188678;19.5442632;19.381342;19.3917523;19.9293989;19.8670507;19.6762796;19.6118629;19.4146059;19.3496876;19.2744025;19.1741645;19.2836001;19.2039698;19.2170388;19.2016748;19.2216557;19.2369995;-0.0129752;-0.0055178;-0.0151607;-0.0040153;19.3769689;19.3585567;19.2830716;19.3667064;19.2997004;19.0854427;19.8912697;19.3651094;19.4355323;19.3133798;19.3365488;0;-0.0001923;2.67e-05;-0.0002163;0.00017;331.7538614;0];
y1_step1.xrows = 62;
y1_step1.keep = [1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 57 58 59 60 61 62];
y1_step1.remove = 56;
y1_step1.constants = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end
if (nargin < 2), error('Initial input states Xi argument needed.'); end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
elseif ~isempty(Xi)
  Q = size(Xi{1},2);
else
  Q = 0;
end

% Input 1 Delay States
Xd1 = cell(1,5);
for ts=1:4
    Xd1{ts} = mapminmax_apply(Xi{1,ts},x1_step1);
end

% Input 2 Delay States
Xd2 = cell(1,5);
for ts=1:4
    temp = removeconstantrows_apply(Xi{2,ts},x2_step1);
    Xd2{ts} = mapminmax_apply(temp,x2_step2);
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

      % Rotating delay state position
      xdts = mod(ts+3,5)+1;
    
    % Input 1
    Xd1{xdts} = mapminmax_apply(X{1,ts},x1_step1);
    
    % Input 2
    temp = removeconstantrows_apply(X{2,ts},x2_step1);
    Xd2{xdts} = mapminmax_apply(temp,x2_step2);
    
    % Layer 1
    tapdelay1 = cat(1,Xd1{mod(xdts-[1 2 3 4]-1,5)+1});
    tapdelay2 = cat(1,Xd2{mod(xdts-[1 2 3 4]-1,5)+1});
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*tapdelay1 + IW1_2*tapdelay2);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    temp = mapminmax_reverse(a2,y1_step2);
    Y{1,ts} = removeconstantrows_reverse(temp,y1_step1);
end

% Final Delay States
finalxts = TS+(1: 4);
xits = finalxts(finalxts<=4);
xts = finalxts(finalxts>4)-4;
Xf = [Xi(:,xits) X(:,xts)];
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
  y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end

% Remove Constants Output Reverse-Processing Function
function x = removeconstantrows_reverse(y,settings)
  Q = size(y,2);
  x = nan(settings.xrows,Q,'like',y);
  x(settings.keep,:) = y;
  x(settings.remove,:) = repmat(settings.constants,1,Q);
end
